<div
  *ngIf="currentOffender | async; let offender; else loading"
  class="surface"
>
  <app-detail-header
    [title]="'Offender Panel'"
    [backLink]="'/'"
  ></app-detail-header>

  <div class="detail-card">
    <div style="display: flex">
      <div style="flex: 1">
        <ng-container>
    <img
      *ngIf="getImageFromPhotos(offender.offenderNumber) | async as photoBlob"
      [src]="photoBlob"
      [alt]="offender.defaultOffenderName.firstName + ' ' + offender.defaultOffenderName.lastName"
    />
  </ng-container>
      </div>
      <div style="flex: 2">
        <div class="label_medium">{{offender?.offenderNumber}}</div>
        <div class="title_xlarge">
          {{offender?.defaultOffenderName?.lastName}}, {{offender?.defaultOffenderName?.firstName}}
        </div>
        <div class="label_medium">
          Last Successful Contact: 
          @if(offender?.lastSuccessfulContact) {
          {{offender?.lastSuccessfulContact?.contactDate ? (offender?.lastSuccessfulContact?.contactDate | date: 'MM/dd/yyyy') : 'N/A'}}
        }
        </div>
      </div>
    </div>
    <br />
    <button
      class="add-contact-button"
      [routerLink]="['/contact-form', offender?.offenderNumber]"
      matRipple
      [matRippleCentered]="centered"
      [matRippleDisabled]="disabled"
      [matRippleUnbounded]="unbounded"
      [matRippleRadius]="radius"
      [matRippleColor]="color"
    >
      <mat-icon svgIcon="add-white"></mat-icon>
      Supervision Contact Entry
    </button>
  </div>
  <br />
  <div class="detail-card">
    <span class="label_large_prominent">Contact Information</span>
    <div style="display: flex; margin-top: 15px">
      <div style="flex: 0">
        <mat-icon
          class="header-icon"
          svgIcon="phone"
          aria-hidden="false"
          aria-label="Back Icon"
          style="cursor: pointer"
        ></mat-icon>
      </div>
      <div style="flex: 1">
        <div class="label_medium">Primary Phone</div>
        <div class="body_small">{{offender?.phone}}</div>
      </div>
    </div>
    <div style="display: flex; margin-top: 15px">
      <div style="flex: 0">
        <mat-icon
          class="header-icon"
          svgIcon="location_on"
          aria-hidden="false"
          aria-label="Back Icon"
          style="cursor: pointer"
        ></mat-icon>
      </div>

      <div style="flex: 1">
        <div class="label_medium">Home Address</div>
        <div class="body_small">
          {{offender?.offenderAddress?.lineOne}}<br />{{offender?.offenderAddress?.city}}, {{offender?.offenderAddress?.state}}
          {{offender?.offenderAddress?.zipCode}}
        </div>
      </div>
    </div>
  </div>

  <!-- **********iterate************ -->
  <ng-container *ngIf="contactList | async as contacts; else loading">
    <app-contact-listing-card
      *ngFor="let contact of contacts"
      [contact]="contact"
    >
    </app-contact-listing-card>
  </ng-container>
  <ng-container *ngIf="existingContactList | async as contacts; else loading">
    <app-contact-listing-card
      *ngFor="let contact of contacts"
      [contact]="contact"
    >
    </app-contact-listing-card>
  </ng-container>
  <ng-template #loading>
    <div class="surface">Loading...</div>
  </ng-template>
  <!-- ********************** -->
</div>
<ng-template #loading>
  <div class="surface">Loading...</div>
</ng-template>
